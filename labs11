#include <iostream>
#include <fstream>
#include <string>
#include <locale.h>
#include <windows.h>
using namespace std;

struct Contact {
string surname;
string name;
string phone;
};

void loadCont(const string& filename, Contact contacts[], int& count) {
ifstream ifs(filename);
count = 0;
while (ifs >> contacts[count].surname >> contacts[count].name >> contacts[count].phone && count < 100)
count++;
}

void saveCont(const string& filename, Contact contacts[], int count) {
ofstream ofs(filename);
for (int i = 0; i < count; i++)
ofs << contacts[i].surname << ' ' << contacts[i].name << ' ' << contacts[i].phone << '\n';
}

void printCont(const Contact contacts[], int count) {
if (count == 0) {
cout << "Справочник пуст.\n";
return;
}
for (int i = 0; i < count; i++) {
cout << contacts[i].surname << ' ' << contacts[i].name << ' ' << contacts[i].phone << '\n';
}
}

void sortirovka(const Contact contacts[], int count) {
Contact temp[100];
for (int i = 0; i < count; i++)
temp[i] = contacts[i];
for (int i = 0; i < count - 1; i++)
for (int j = i + 1; j < count; j++)
if (temp[i].surname > temp[j].surname)
swap(temp[i], temp[j]);
printCont(temp, count);
}

void addCont(const string& filename, Contact contacts[], int& count) {
Contact c;
cout << "Фамилия: ";
getline(cin, c.surname);
if (c.surname.empty()) {
cout << "Пустая фамилия, добавление отменено.\n";
return;
}
cout << "Имя: ";
getline(cin, c.name);
if (c.name.empty()) {
cout << "Пустое имя, добавление отменено.\n";
return;
}
cout << "Телефон: ";
getline(cin, c.phone);
if (c.phone.empty()) {
cout << "Пустой телефон, добавление отменено.\n";
return;
}
ofstream ofs(filename, ios::app);
ofs << c.surname << ' ' << c.name << ' ' << c.phone << '\n';
if (count < 100) {
contacts[count] = c;
count++;
}
}

void search(const string& filename) {
ifstream ifs(filename);
string s, n, p, surname;
cout << "Фамилия для поиска: ";
getline(cin, surname);
if (surname.empty()) {
cout << "Пустая строка, поиск отменен.\n";
return;
}
bool found = false;
while (ifs >> s >> n >> p) {
if (s == surname) {
cout << s << ' ' << n << ' ' << p << '\n';
found = true;
}
}
if (!found) {
cout << "В справочнике данных нет.\n";
}
}

int main() {
SetConsoleCP(1251);
SetConsoleOutputCP(1251);
string filename; cout << "Имя файла: "; getline(cin, filename); ifstream ifs(filename);
if (!ifs) {
cout << "Файл не существует. Создать файл? (д/н): ";
char c; cin >> c; cin.ignore();
if (c == 'Д' || c == 'д') {
ofstream(filename).close(); cout << "Файл создан.\n";
}
else { return 0; }
}
Contact contacts[100]; int count = 0;
loadCont(filename, contacts, count); int cmd;
do {
cout << "\nМеню:\n" << "1. Вывод на экран\n" << "2. Добавление\n" << "3. Поиск\n" << "4. Завершение работы\n" << "Выбор: ";
cin >> cmd; cin.ignore();
if (cin.fail()) { cout << "Ошибка ввода. Пожалуйста, введите число.\n"; break; }
switch (cmd) {
case 1:
loadCont(filename, contacts, count); sortirovka(contacts, count); break;
case 2:
addCont(filename, contacts, count); break;
case 3:
search(filename); break;
case 4:
cout << "Выход.\n"; break;
default:
cout << "Некорректный ввод. Попробуйте снова.\n";
}
} while (cmd != 4);
return 0; }
